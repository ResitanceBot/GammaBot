<launch>
    <arg name="localization" default="true" />
    <arg name="map_name" default="pasillo_patio.yaml" />
    <arg name="slam" default="false" />
    <arg name="CNN" default="true" />
    <arg name="markers" default="true" />
    <arg name="gui_server" default="true" />
    <arg name="move_base" default="false" />

    <group if="$(arg slam)">
        <include file="$(find tutorial_pkg)/launch/gmapping.launch" />
    </group>

    <group if="$(arg localization)">
        <!-- Load map -->
        <node name="map_server" pkg="map_server" type="map_server"
            args="$(find tutorial_pkg)/maps/$(arg map_name)" respawn="true" />

        <!-- AMCL localizer -->
        <node pkg="amcl" type="amcl" name="amcl" output="screen">
            <param name="odom_frame_id" value="odom" />
            <param name="odom_model_type" value="diff-corrected" />
            <param name="base_frame_id" value="base_link" />
            <param name="update_min_d" value="0.1" />
            <param name="update_min_a" value="0.2" />
            <param name="min_particles" value="100" />
            <param name="global_frame_id" value="map" />
            <param name="tf_broadcast" value="true" />
            <param name="initial_pose_x" value="0.0" />
            <param name="initial_pose_y" value="0.0" />
            <param name="initial_pose_a" value="0.0" />
        </node>

        <group if="$(arg move_base)">
            <!-- Path planning -->
            <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
                <rosparam file="$(find tutorial_pkg)/config/move_base.yaml" command="load" />
                <rosparam file="$(find tutorial_pkg)/config/costmap_common.yaml" command="load"
                    ns="global_costmap" />
                <rosparam file="$(find tutorial_pkg)/config/costmap_common.yaml" command="load"
                    ns="local_costmap" />
                <rosparam file="$(find tutorial_pkg)/config/costmap_global.yaml" command="load" />
                <rosparam file="$(find tutorial_pkg)/config/costmap_local.yaml" command="load" />
                <rosparam file="$(find tutorial_pkg)/config/planner_global.yaml" command="load" />
                <rosparam file="$(find tutorial_pkg)/config/planner_local.yaml" command="load" />
            </node>
        </group>

    </group>

    <group if="$(arg CNN)">
        <include file="$(find cnn_image_processing)/launch/cnn.launch" />
        <node name="image_rt_uncompressor" pkg="image_transport" type="republish"
            args="compressed in:=/camera/color/image_compressed raw out:=/camera/color/image_uncompressed" />
    </group>

    <group if="$(arg markers)">
        <node pkg="map_marker" type="map_marker" name="map_marker" output="screen" />
        <node pkg="map_marker" type="marker_tf_broadcaster" name="marker_tf_broadcaster"
            output="screen" />
    </group>

    <group if="$(arg gui_server)">
        <include file="$(find robot_gui_bridge)/launch/websocket.launch" />
    </group>

    <!-- RVIZ -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find map_marker)/rviz/slam_marker.rviz" />

</launch>